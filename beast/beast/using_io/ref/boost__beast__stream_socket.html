<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>stream_socket</title>
<link rel="stylesheet" href="../../../../../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="../../../index.html" title="Chapter&#160;1.&#160;Boost.Beast">
<link rel="up" href="../ref.html" title="This Page Intentionally Left Blank 2/2">
<link rel="prev" href="boost__beast__static_string/value_type.html" title="static_string::value_type">
<link rel="next" href="boost__beast__string_param.html" title="string_param">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../../../boost.png"></td>
<td align="center"><a href="../../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="boost__beast__static_string/value_type.html"><img src="../../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../ref.html"><img src="../../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="boost__beast__string_param.html"><img src="../../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h5 class="title">
<a name="beast.using_io.ref.boost__beast__stream_socket"></a><a class="link" href="boost__beast__stream_socket.html" title="stream_socket">stream_socket</a>
</h5></div></div></div>
<p>
          <a class="indexterm" name="id1523038"></a>
A TCP/IP stream socket which supports timeouts and rate limits.
        </p>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h0"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.synopsis"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.synopsis">Synopsis</a>
        </h6>
<p>
          Defined in header <code class="literal">&lt;<a href="../../../../../../../boost/beast/core/stream_socket.hpp" target="_top">boost/beast/core/stream_socket.hpp</a>&gt;</code>
        </p>
<pre class="programlisting"><span class="keyword">using</span> <span class="identifier">stream_socket</span> <span class="special">=</span> <span class="identifier">basic_stream_socket</span><span class="special">&lt;</span> <span class="identifier">net</span><span class="special">::</span><span class="identifier">ip</span><span class="special">::</span><span class="identifier">tcp</span><span class="special">,</span> <span class="identifier">net</span><span class="special">::</span><span class="identifier">io_context</span><span class="special">::</span><span class="identifier">executor_type</span> <span class="special">&gt;;</span>
</pre>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h1"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.types"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.types">Types</a>
        </h6>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                  <p>
                    Name
                  </p>
                </th>
<th>
                  <p>
                    Description
                  </p>
                </th>
</tr></thead>
<tbody>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>endpoint_type</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    The endpoint type.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>executor_type</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    The type of the executor associated with the object.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>lowest_layer_type</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    The type of the lowest layer.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>next_layer_type</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    The type of the next layer.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>protocol_type</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    The protocol type.
                  </p>
                </td>
</tr>
</tbody>
</table></div>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h2"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.member_functions"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.member_functions">Member
          Functions</a>
        </h6>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                  <p>
                    Name
                  </p>
                </th>
<th>
                  <p>
                    Description
                  </p>
                </th>
</tr></thead>
<tbody>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>async_read_some</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Start an asynchronous read.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>async_write_some</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Start an asynchronous write.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>basic_stream_socket</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Construct a basic_stream_socket without opening it.
                  </p>
                  <p>
                    Construct and open a basic_stream_socket.
                  </p>
                  <p>
                    Construct a basic_stream_socket, opening and binding it to the
                    given local endpoint.
                  </p>
                  <p>
                    Move-construct a basic_stream_socket from another.
                  </p>
                  <p>
                    Move-construct a basic_stream_socket from a socket of another
                    protocol and executor type.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>close</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Close the timed stream.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>expires_after</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Set the timeout for the next logical operation.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>expires_at</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Set the timeout for the next logical operation.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>expires_never</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Disable the timeout for the next logical operation.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>get_executor</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Get the executor associated with the object.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>lowest_layer</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Get a reference to the lowest layer.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>next_layer</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Get a reference to the next layer.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>operator=</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Move-assign a basic_stream_socket from another.
                  </p>
                  <p>
                    Move-assign a basic_stream_socket from a socket of another protocol
                    and executor type.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>read_limit</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Set the number of bytes allowed to be read per second.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>write_limit</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Set the number of bytes allowed to be written per second.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <a class="link" href="../../../"><span class="bold"><strong>~basic_stream_socket</strong></span></a>
                  </p>
                </td>
<td>
                  <p>
                    Destructor.
                  </p>
                </td>
</tr>
</tbody>
</table></div>
<p>
          This wraps a normal stream socket to provide the following additional features:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
              The class template is parameterized on a user-defined executor used
              for asynchronous operations. This achieves partial support for "Networking
              TS enhancement to enable custom I/O executors" [P1322R0].
            </li>
<li class="listitem">
              Optional timeouts may be specified for logical operations which perform
              asynchronous reads, writes, and connects.
            </li>
<li class="listitem">
              Optional bytes-per-second rate limits may be set independently on asynchronous
              reads and writes.
            </li>
</ul></div>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h3"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.usage"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.usage">Usage</a>
        </h6>
<p>
          Objects of this type are designed to be used in places where a regular
          networking TCP/IP socket is being used. In particular this class template
          replaces <code class="computeroutput"><span class="identifier">net</span><span class="special">::</span><span class="identifier">basic_stream_socket</span></code>. The constructors
          used here are similar to those of networking sockets, but with the ability
          to use either an executor or an execution context when constructing the
          socket.
        </p>
<p>
          The caller is responsible for ensuring that all stream operations, including
          the internal timer operations, are running from the same implicit or explicit
          strand. When there are multiple threads calling <code class="computeroutput"><span class="identifier">net</span><span class="special">::</span><span class="identifier">io_context</span><span class="special">::</span><span class="identifier">run</span></code>,
          the <code class="computeroutput"><span class="identifier">Executor</span></code> template parameter,
          and the instance of that executor type passed to the constructor must provide
          the following guarantees:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
              <span class="bold"><strong>Serial Execution:</strong></span> Function objects
              submitted to the executor shall never run concurrently.
            </li>
<li class="listitem">
              <span class="bold"><strong>Ordering:</strong></span> Function objects submitted
              to the executor from the same thread shall execute in the order they
              were submitted.
            </li>
</ul></div>
<p>
          If only one thread is calling <code class="computeroutput"><span class="identifier">net</span><span class="special">::</span><span class="identifier">io_context</span><span class="special">::</span><span class="identifier">run</span></code>,
          the executor may be the executor used by the I/O context (<code class="computeroutput"><span class="identifier">net</span><span class="special">::</span><span class="identifier">io_context</span><span class="special">::</span><span class="identifier">executor_type</span></code>). Otherwise, a <code class="computeroutput"><span class="identifier">net</span><span class="special">::</span><span class="identifier">strand</span></code> may be used to meet the requirements.
          Note that when using a strand to instantiate the socket, it is not necessary
          to also bind each submitted completion handler used in subsequent operations
          to the strand, this is taken care of automatically.
        </p>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h4"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.using_executors"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.using_executors">Using
          Executors</a>
        </h6>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h5"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.using_timeouts"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.using_timeouts">Using
          Timeouts</a>
        </h6>
<p>
          To use this stream declare an instance of the class. Then, before each
          logical operation for which a timeout is desired, call <a class="link" href="../../../"><code class="computeroutput"><span class="identifier">basic_stream_socket</span><span class="special">::</span><span class="identifier">expires_after</span></code></a> with a duration,
          or call <a class="link" href="../../../"><code class="computeroutput"><span class="identifier">basic_stream_socket</span><span class="special">::</span><span class="identifier">expires_at</span></code></a> with a time point.
          Alternatively, call <a class="link" href="../../../"><code class="computeroutput"><span class="identifier">basic_stream_socket</span><span class="special">::</span><span class="identifier">expires_never</span></code></a> to disable the timeout
          for subsequent logical operations.
        </p>
<p>
          A logical operation is defined as one of the following:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
              A call to <a class="link" href="../../../"><code class="computeroutput"><span class="identifier">async_connect</span></code></a> where the stream
              is passed as the first argument.
            </li>
<li class="listitem">
              One or more calls to either one or both of the stream's <a class="link" href="../../../"><code class="computeroutput"><span class="identifier">basic_stream_socket</span><span class="special">::</span><span class="identifier">async_read_some</span></code></a> and <a class="link" href="../../../"><code class="computeroutput"><span class="identifier">basic_stream_socket</span><span class="special">::</span><span class="identifier">async_write_some</span></code></a> member functions.
              This also includes indirect calls, for example when passing the stream
              as the first argument to an initiating function such as <code class="computeroutput"><span class="identifier">net</span><span class="special">::</span><span class="identifier">async_read_until</span></code>.
            </li>
</ul></div>
<p>
          Each logical operation can be considered as peforming just reads, just
          writes, or both reads and writes. Calls to <a class="link" href="../../../"><code class="computeroutput"><span class="identifier">async_connect</span></code></a> count as both a
          read and a write, although no actual reads or writes are performed. While
          logical operations can include both reading and writing, the usual restriction
          on having at most one read and one write outstanding simultaneously applies.
        </p>
<p>
          The implementation maintains two timers: one timer for reads, and another
          timer for writes. When the expiration time is adjusted (by calling <a class="link" href="../../../"><code class="computeroutput"><span class="identifier">basic_stream_socket</span><span class="special">::</span><span class="identifier">expires_after</span></code></a> or <a class="link" href="../../../"><code class="computeroutput"><span class="identifier">basic_stream_socket</span><span class="special">::</span><span class="identifier">expires_at</span></code></a>), the indiviudal timer
          is only set if there is not currently an operation of that type (read or
          write) outstanding. It is undefined behavior to set an expiration when
          there is both a read and a write pending, since there would be no available
          timer to apply the expiration to.
        </p>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h6"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.example"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.example">Example</a>
        </h6>
<p>
          This code sets a timeout, and uses a generic networking stream algorithm
          to read data from a timed stream until a particular delimiter is found
          or until the stream times out:
        </p>
<pre class="programlisting"><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">Protocol</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">Executor</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">ReadHandler</span><span class="special">&gt;</span>
<span class="keyword">void</span> <span class="identifier">async_read_line</span> <span class="special">(</span>
    <span class="identifier">basic_stream_socket</span><span class="special">&lt;</span><span class="identifier">Protocol</span><span class="special">,</span> <span class="identifier">Executor</span><span class="special">&gt;&amp;</span> <span class="identifier">stream</span><span class="special">,</span>
    <span class="identifier">net</span><span class="special">::</span><span class="identifier">streambuf</span><span class="special">&amp;</span> <span class="identifier">buffer</span><span class="special">,</span> <span class="identifier">ReadHandler</span><span class="special">&amp;&amp;</span> <span class="identifier">handler</span><span class="special">)</span>
<span class="special">{</span>
    <span class="identifier">stream</span><span class="special">.</span><span class="identifier">expires_after</span> <span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">chrono</span><span class="special">::</span><span class="identifier">seconds</span><span class="special">(</span><span class="number">30</span><span class="special">));</span>

    <span class="identifier">net</span><span class="special">::</span><span class="identifier">async_read_until</span> <span class="special">(</span><span class="identifier">stream</span><span class="special">,</span> <span class="identifier">buffer</span><span class="special">,</span> <span class="string">"\r\n"</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">forward</span><span class="special">&lt;</span><span class="identifier">ReadHandler</span><span class="special">&gt;(</span><span class="identifier">handler</span><span class="special">));</span>
<span class="special">}</span>
</pre>
<p>
          When a timeout occurs the socket will be closed, canceling any pending
          I/O operations. The completion handlers for these canceled operations will
          be invoked with the error <a class="link" href="../../../"><code class="computeroutput"><span class="identifier">timeout</span></code></a>.
        </p>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h7"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.using_rate_limits"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.using_rate_limits">Using
          Rate Limits</a>
        </h6>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h8"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.template_parameters"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.template_parameters">Template
          Parameters</a>
        </h6>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                  <p>
                    Type
                  </p>
                </th>
<th>
                  <p>
                    Description
                  </p>
                </th>
</tr></thead>
<tbody>
<tr>
<td>
                  <p>
                    <code class="computeroutput"><span class="identifier">Protocol</span></code>
                  </p>
                </td>
<td>
                  <p>
                    A type meeting the requirements of Protocol representing the
                    protocol the protocol to use for the basic stream socket. A common
                    choice is <code class="computeroutput"><span class="identifier">net</span><span class="special">::</span><span class="identifier">ip</span><span class="special">::</span><span class="identifier">tcp</span></code>.
                  </p>
                </td>
</tr>
<tr>
<td>
                  <p>
                    <code class="computeroutput"><span class="identifier">Executor</span></code>
                  </p>
                </td>
<td>
                  <p>
                    A type meeting the requirements of Executor to be used for submitting
                    all completion handlers which do not already have an associated
                    executor.
                  </p>
                </td>
</tr>
</tbody>
</table></div>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h9"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.remarks"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.remarks">Remarks</a>
        </h6>
<p>
          A multi-stream object must not be moved or destroyed while there are oustanding
          asynchronous operations associated with it. Objects of this type meet the
          requirements of <span class="bold"><strong>AsyncReadStream</strong></span> and <span class="bold"><strong>AsyncWriteStream</strong></span>.
        </p>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h10"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.thread_safety"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.thread_safety">Thread
          Safety</a>
        </h6>
<p>
          <span class="emphasis"><em>Distinct objects</em></span>: Safe.
        </p>
<p>
          <span class="emphasis"><em>Shared objects</em></span>: Unsafe. The application must also
          ensure that all asynchronous operations are performed within the same implicit
          or explicit strand.
        </p>
<h6>
<a name="beast.using_io.ref.boost__beast__stream_socket.h11"></a>
          <span class="phrase"><a name="beast.using_io.ref.boost__beast__stream_socket.see_also"></a></span><a class="link" href="boost__beast__stream_socket.html#beast.using_io.ref.boost__beast__stream_socket.see_also">See Also</a>
        </h6>
<p>
          <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p1322r0.html" target="_top">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p1322r0.html</a>
        </p>
<p>
          Convenience header <code class="literal">&lt;<a href="../../../../../../../boost/beast/core.hpp" target="_top">boost/beast/core.hpp</a>&gt;</code>
        </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2016, 2017 Vinnie Falco<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="boost__beast__static_string/value_type.html"><img src="../../../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../ref.html"><img src="../../../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="boost__beast__string_param.html"><img src="../../../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
