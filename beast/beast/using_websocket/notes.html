<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Notes</title>
<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="../../index.html" title="Beast">
<link rel="up" href="../using_websocket.html" title="Using WebSocket">
<link rel="prev" href="control_frames.html" title="Control Frames">
<link rel="next" href="../concepts.html" title="Concepts">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr><td valign="top"><img alt="Beast Logo" width="1330" height="80" src="../../images/beast.png"></td></tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="control_frames.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../using_websocket.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="../concepts.html"><img src="../../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="beast.using_websocket.notes"></a><a class="link" href="notes.html" title="Notes">Notes</a>
</h3></div></div></div>
<p>
        Because calls to read data may return a variable amount of bytes, the interface
        to calls that read data require an object that meets the requirements of
        <a class="link" href="../concepts/DynamicBuffer.html" title="DynamicBuffer"><span class="bold"><strong>DynamicBuffer</strong></span></a>.
        This concept is modeled on <a href="http://www.boost.org/doc/html/boost_asio/reference/streambuf.html" target="_top"><code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">asio</span><span class="special">::</span><span class="identifier">streambuf</span></code></a>.
      </p>
<p>
        The implementation does not perform queueing or buffering of messages. If
        desired, these features should be provided by callers. The impact of this
        design is that library users are in full control of the allocation strategy
        used to store data and the back-pressure applied on the read and write side
        of the underlying TCP/IP connection.
      </p>
<h5>
<a name="beast.using_websocket.notes.h0"></a>
        <span class="phrase"><a name="beast.using_websocket.notes.asynchronous_operations"></a></span><a class="link" href="notes.html#beast.using_websocket.notes.asynchronous_operations">Asynchronous
        Operations</a>
      </h5>
<p>
        Asynchronous versions are available for all functions:
      </p>
<pre class="programlisting"><span class="identifier">multi_buffer</span> <span class="identifier">buffer</span><span class="special">;</span>
<span class="identifier">ws</span><span class="special">.</span><span class="identifier">async_read</span><span class="special">(</span><span class="identifier">buffer</span><span class="special">,</span>
    <span class="special">[](</span><span class="identifier">error_code</span><span class="special">)</span>
    <span class="special">{</span>
        <span class="comment">// Do something with the buffer</span>
    <span class="special">});</span>
</pre>
<p>
        Calls to asynchronous initiation functions support the extensible asynchronous
        model developed by the Boost.Asio author, allowing for traditional completion
        handlers, stackful or stackless coroutines, and even futures:
      </p>
<pre class="programlisting"><span class="keyword">void</span> <span class="identifier">echo</span><span class="special">(</span><span class="identifier">stream</span><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">asio</span><span class="special">::</span><span class="identifier">ip</span><span class="special">::</span><span class="identifier">tcp</span><span class="special">::</span><span class="identifier">socket</span><span class="special">&gt;&amp;</span> <span class="identifier">ws</span><span class="special">,</span>
    <span class="identifier">multi_buffer</span><span class="special">&amp;</span> <span class="identifier">buffer</span><span class="special">,</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">asio</span><span class="special">::</span><span class="identifier">yield_context</span> <span class="identifier">yield</span><span class="special">)</span>
<span class="special">{</span>
    <span class="identifier">ws</span><span class="special">.</span><span class="identifier">async_read</span><span class="special">(</span><span class="identifier">buffer</span><span class="special">,</span> <span class="identifier">yield</span><span class="special">);</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">future</span><span class="special">&lt;</span><span class="keyword">void</span><span class="special">&gt;</span> <span class="identifier">fut</span> <span class="special">=</span>
        <span class="identifier">ws</span><span class="special">.</span><span class="identifier">async_write</span><span class="special">(</span><span class="identifier">buffer</span><span class="special">.</span><span class="identifier">data</span><span class="special">(),</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">asio</span><span class="special">::</span><span class="identifier">use_future</span><span class="special">);</span>
<span class="special">}</span>
</pre>
<h5>
<a name="beast.using_websocket.notes.h1"></a>
        <span class="phrase"><a name="beast.using_websocket.notes.the_io_service"></a></span><a class="link" href="notes.html#beast.using_websocket.notes.the_io_service">The
        io_service</a>
      </h5>
<p>
        The creation and operation of the <a href="http://www.boost.org/doc/html/boost_asio/reference/io_service.html" target="_top"><code class="computeroutput"><span class="identifier">io_service</span></code></a> associated with the
        underlying stream is left to the callers, permitting any implementation strategy
        including one that does not require threads for environments where threads
        are unavailable. Beast WebSocket itself does not use or require threads.
      </p>
<h5>
<a name="beast.using_websocket.notes.h2"></a>
        <span class="phrase"><a name="beast.using_websocket.notes.thread_safety"></a></span><a class="link" href="notes.html#beast.using_websocket.notes.thread_safety">Thread
        Safety</a>
      </h5>
<p>
        Like a regular <a href="http://www.boost.org/doc/html/boost_asio.html" target="_top">Boost.Asio</a>
        socket, a <a class="link" href="../ref/beast__websocket__stream.html" title="websocket::stream"><code class="computeroutput"><span class="identifier">stream</span></code></a> is not thread safe. Callers
        are responsible for synchronizing operations on the socket using an implicit
        or explicit strand, as per the Asio documentation. The asynchronous interface
        supports one active read and one active write simultaneously. Undefined behavior
        results if two or more reads or two or more writes are attempted concurrently.
        Caller initiated WebSocket ping, pong, and close operations each count as
        an active write.
      </p>
<p>
        The implementation uses composed asynchronous operations internally; a high
        level read can cause both reads and writes to take place on the underlying
        stream. This behavior is transparent to callers.
      </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2013-2017 Vinnie Falco<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="control_frames.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../using_websocket.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="../concepts.html"><img src="../../images/next.png" alt="Next"></a>
</div>
</body>
</html>
