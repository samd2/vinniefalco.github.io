<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>rekey</title>
<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="../../index.html" title="NuDB">
<link rel="up" href="../ref.html" title="Reference">
<link rel="prev" href="nudb__recover.html" title="recover">
<link rel="next" href="nudb__store.html" title="store">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr><td valign="top"><img alt="NuDB Logo" width="1270" height="80" src="../../images/logo.png"></td></tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="nudb__recover.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../ref.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="nudb__store.html"><img src="../../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="nudb.ref.nudb__rekey"></a><a class="link" href="nudb__rekey.html" title="rekey">rekey</a>
</h3></div></div></div>
<p>
        <a class="indexterm" name="id992664"></a>
Create a new key file from a data file.
      </p>
<h5>
<a name="nudb.ref.nudb__rekey.h0"></a>
        <span class="phrase"><a name="nudb.ref.nudb__rekey.synopsis"></a></span><a class="link" href="nudb__rekey.html#nudb.ref.nudb__rekey.synopsis">Synopsis</a>
      </h5>
<pre class="programlisting"><span class="keyword">template</span><span class="special">&lt;</span>
    <span class="keyword">class</span> <span class="identifier">Hasher</span><span class="special">,</span>
    <span class="keyword">class</span> <span class="identifier">File</span><span class="special">,</span>
    <span class="keyword">class</span> <span class="identifier">Progress</span><span class="special">,</span>
    <span class="keyword">class</span><span class="special">...</span> <span class="identifier">Args</span><span class="special">&gt;</span>
<span class="keyword">void</span>
<span class="identifier">rekey</span><span class="special">(</span>
    <span class="identifier">path_type</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">dat_path</span><span class="special">,</span>
    <span class="identifier">path_type</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">key_path</span><span class="special">,</span>
    <span class="identifier">path_type</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">log_path</span><span class="special">,</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">size_t</span> <span class="identifier">blockSize</span><span class="special">,</span>
    <span class="keyword">float</span> <span class="identifier">loadFactor</span><span class="special">,</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">uint64_t</span> <span class="identifier">itemCount</span><span class="special">,</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">size_t</span> <span class="identifier">bufferSize</span><span class="special">,</span>
    <span class="identifier">error_code</span><span class="special">&amp;</span> <span class="identifier">ec</span><span class="special">,</span>
    <span class="identifier">Progress</span><span class="special">&amp;&amp;</span> <span class="identifier">progress</span><span class="special">,</span>
    <span class="identifier">Args</span><span class="special">&amp;&amp;...</span> <span class="identifier">args</span><span class="special">);</span>
</pre>
<h5>
<a name="nudb.ref.nudb__rekey.h1"></a>
        <span class="phrase"><a name="nudb.ref.nudb__rekey.description"></a></span><a class="link" href="nudb__rekey.html#nudb.ref.nudb__rekey.description">Description</a>
      </h5>
<p>
        This algorithm rebuilds a key file for the given data file. It works efficiently
        by iterating the data file multiple times. During the iteration, a contiguous
        block of the key file is rendered in memory, then flushed to disk when the
        iteration is complete. The size of this memory buffer is controlled by the
        <code class="computeroutput"><span class="identifier">bufferSize</span></code> parameter, larger
        is better. The algorithm works the fastest when <code class="computeroutput"><span class="identifier">bufferSize</span></code>
        is large enough to hold the entire key file in memory; only a single iteration
        of the data file is needed in this case.
      </p>
<p>
        During the rekey, spill records may be appended to the data file. If the
        rekey operation is abnormally terminated, this would normally result in a
        corrupted data file. To prevent this, the function creates a log file using
        the specified path so that the database can be fixed in a subsequent call
        to <a class="link" href="nudb__recover.html" title="recover"><code class="computeroutput"><span class="identifier">recover</span></code></a>.
      </p>
<h5>
<a name="nudb.ref.nudb__rekey.h2"></a>
        <span class="phrase"><a name="nudb.ref.nudb__rekey.remarks"></a></span><a class="link" href="nudb__rekey.html#nudb.ref.nudb__rekey.remarks">Remarks</a>
      </h5>
<p>
        If a log file is already present, this function will fail with <a class="link" href="nudb__error.html" title="error"><code class="computeroutput"><span class="identifier">log_file_exists</span></code></a>.
      </p>
<h5>
<a name="nudb.ref.nudb__rekey.h3"></a>
        <span class="phrase"><a name="nudb.ref.nudb__rekey.template_parameters"></a></span><a class="link" href="nudb__rekey.html#nudb.ref.nudb__rekey.template_parameters">Template
        Parameters</a>
      </h5>
<h5>
<a name="nudb.ref.nudb__rekey.h4"></a>
        <span class="phrase"><a name="nudb.ref.nudb__rekey.template_parameters0"></a></span><a class="link" href="nudb__rekey.html#nudb.ref.nudb__rekey.template_parameters0">Template
        Parameters</a>
      </h5>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                <p>
                  Type
                </p>
              </th>
<th>
                <p>
                  Description
                </p>
              </th>
</tr></thead>
<tbody>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">Hasher</span></code>
                </p>
              </td>
<td>
                <p>
                  The hash function to use. This type must meet the requirements
                  of Hasher. The hash function must be the same as that used to create
                  the database, or else an error is returned.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">File</span></code>
                </p>
              </td>
<td>
                <p>
                  The type of file to use. This type must meet the requirements of
                  File.
                </p>
              </td>
</tr>
</tbody>
</table></div>
<h5>
<a name="nudb.ref.nudb__rekey.h5"></a>
        <span class="phrase"><a name="nudb.ref.nudb__rekey.parameters"></a></span><a class="link" href="nudb__rekey.html#nudb.ref.nudb__rekey.parameters">Parameters</a>
      </h5>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                <p>
                  Name
                </p>
              </th>
<th>
                <p>
                  Description
                </p>
              </th>
</tr></thead>
<tbody>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">dat_path</span></code>
                </p>
              </td>
<td>
                <p>
                  The path to the data file.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">key_path</span></code>
                </p>
              </td>
<td>
                <p>
                  The path to the key file.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">log_path</span></code>
                </p>
              </td>
<td>
                <p>
                  The path to the log file.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">blockSize</span></code>
                </p>
              </td>
<td>
                <p>
                  The size of a key file block. Larger blocks hold more keys but
                  require more I/O cycles per operation. The ideal block size the
                  largest size that may be read in a single I/O cycle, and device
                  dependent. The return value of <span class="red">|9|block_size</span>
                  returns a suitable value for the volume of a given path.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">loadFactor</span></code>
                </p>
              </td>
<td>
                <p>
                  A number between zero and one representing the average bucket occupancy
                  (number of items). A value of 0.5 is perfect. Lower numbers waste
                  space, and higher numbers produce negligible savings at the cost
                  of increased I/O cycles.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">itemCount</span></code>
                </p>
              </td>
<td>
                <p>
                  The number of items in the data file.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">bufferSize</span></code>
                </p>
              </td>
<td>
                <p>
                  The number of bytes to allocate for the buffer.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">ec</span></code>
                </p>
              </td>
<td>
                <p>
                  Set to the error if any occurred.
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">progress</span></code>
                </p>
              </td>
<td>
                <p>
                  A function which will be called periodically as the algorithm proceeds.
                  The equivalent signature of the progress function must be:
                </p>
<pre xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" class="table-programlisting"><span class="keyword">void</span> <span class="identifier">progress</span><span class="special">(</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">uint64_t</span> <span class="identifier">amount</span><span class="special">,</span>   <span class="comment">// Amount of work done so far</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">uint64_t</span> <span class="identifier">total</span>     <span class="comment">// Total amount of work to do</span>
<span class="special">);</span>
</pre>
              </td>
</tr>
<tr>
<td>
                <p>
                  <code class="computeroutput"><span class="identifier">args</span></code>
                </p>
              </td>
<td>
                <p>
                  Optional arguments passed to File constructors.
                </p>
              </td>
</tr>
</tbody>
</table></div>
<h5>
<a name="nudb.ref.nudb__rekey.h6"></a>
        <span class="phrase"><a name="nudb.ref.nudb__rekey.header"></a></span><a class="link" href="nudb__rekey.html#nudb.ref.nudb__rekey.header">Header</a>
      </h5>
<p>
        <code class="computeroutput"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">nudb</span><span class="special">/</span><span class="identifier">rekey</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span></code>
      </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2015, 2016 Vinnie Falco<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="nudb__recover.html"><img src="../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../ref.html"><img src="../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../images/home.png" alt="Home"></a><a accesskey="n" href="nudb__store.html"><img src="../../images/next.png" alt="Next"></a>
</div>
</body>
</html>
